<!DOCTYPE html>

<html lang="en">
<head>
    <title>Chapter 6 - FtpServer internals &mdash; Apache MINA</title>

    <link href="/assets/css/common.css" rel="stylesheet" type="text/css"/>
    <link href="/assets/css/ftpserver.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<script src="https://www.apachecon.com/event-images/snippet.js"></script>
<div id="container">
    <div id="header">
    <div id="subProjectsNavBar">
        <a href="/">
            
                Apache MINA Project
            
        </a>
        &nbsp;|&nbsp;
        <a href="/mina-project/">
            
                MINA
            
        </a>
        &nbsp;|&nbsp;
        <a href="/asyncweb-project/">
            
                AsyncWeb
            
        </a>
        &nbsp;|&nbsp;
        <a href="/ftpserver-project/">
            
                <strong>FtpServer</strong>
            
        </a>
        &nbsp;|&nbsp;
        <a href="/sshd-project/">
            
                SSHD
            
        </a>
        &nbsp;|&nbsp;
        <a href="/vysper-project/">
            
                Vysper
            
        </a>
    </div>
</div>


    <div id="content">
        <div id="leftColumn">
            <div id="navigation">
                <a class="acevent" data-format="wide" data-width="170"></a>
                <h5>Social Networks</h5>
                <ul>
                    <li><a href="https://fosstodon.org/@apachemina">Apache MINA Mastodon</a></li>
                </ul>
                <h5>Overview</h5>
                <ul>
                    <li><a href="/ftpserver-project/index.html">Home</a> </li>
                    <li><a href="/ftpserver-project/features.html">Features</a> </li>
                    <li><a href="/ftpserver-project/download_1_1.html">FtpServer 1.1.4</a></li>
                    <li><a href="/ftpserver-project/download_1_2.html">FtpServer 1.2.0</a></li>
                    <li><a href="/ftpserver-project/old-downloads.html">Old Downloads</a></li>
                    <li><a href="/ftpserver-project/documentation.html">Documentation</a></li>
                    <li><a href="/ftpserver-project/gen-docs/latest-1.1/apidocs/index.html" class="external-link" rel="nofollow">API Javadoc 1.1.4</a></li>
                    <li><a href="/ftpserver-project/gen-docs/latest-1.2/apidocs/index.html" class="external-link" rel="nofollow">API Javadoc 1.2.0</a></li>
                    <li><a href="/ftpserver-project/getting_source.html">Sources</a></li>
                    <li><a href="/ftpserver-project/faq.html">FAQ</a></li>
                    <li><a href="/ftpserver-project/related_project.html">Related Project</a></li>
                </ul>

                <h5>Community</h5>
                <ul>
                    <li><a href="/ftpserver-project/mailing_list.html">Mailing Lists</a></li>
                    <li><a href="/ftpserver-project/getting_involved.html">Getting Involved</a></li>
                    <li><a href="/ftpserver-project/reporting_bug.html">Reporting a Bug</a></li>
                    <li><a href="/ftpserver-project/contributors.html">Contributors</a></li>
                    <li><a href="https://www.apache.org/foundation/contributing.html">Contributing</a></li>
                    <li><a href="https://www.apache.org/licenses/">License</a></li>
                    <li><a href="https://www.apache.org/security/">Security</a></li>
                </ul>

                <h5>Sponsorship</h5>
                <ul>
                    <li><a href="https://www.apache.org/foundation/thanks.html">Thanks</a></li>
                    <li><a href="https://www.apache.org/foundation/sponsorship.html">Sponsorship</a></li>
                    <li><a href="https://www.apache.org/">apache.org</a></li>
                </ul>
            </div>
        </div>
        <div id="rightColumn">
            
    <div class="nav">
        <div class="nav_prev">
            
                
                <a href="../ch5-developping/ch5-developping.html">Chapter 5 - Developping</a>
            
        </div>
        <div class="nav_up">
            
                
                <a href="../documentation-toc.html">Documentation</a>
            
        </div>
        <div class="nav_next">
            
                &nbsp;
            
        </div>
        <div class="clearfix"></div>
    </div>


            
	<h1 id="chapter-6---internals">Chapter 6 - Internals</h1>
<p>Creating a <strong>FtpServer</strong> instance is done using a <strong>FtpServerFactory</strong>. The is done with such code:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">    FtpServerFactory serverFactory <span style="color:#666">=</span> <span style="color:#a2f;font-weight:bold">new</span> FtpServerFactory<span style="color:#666">(</span><span style="color:#666">)</span><span style="color:#666">;</span>
    FtpServer server <span style="color:#666">=</span> serverFactory<span style="color:#666">.</span><span style="color:#b44">createServer</span><span style="color:#666">(</span><span style="color:#666">)</span><span style="color:#666">;</span>
    server<span style="color:#666">.</span><span style="color:#b44">start</span><span style="color:#666">(</span><span style="color:#666">)</span><span style="color:#666">;</span>
    <span style="color:#666">.</span><span style="color:#666">.</span><span style="color:#666">.</span>
</code></pre></div><p>Let&rsquo;s see what happens when we create the factory and when the server is created</p>
<h2 id="ftpserverfactory-creation">FtpServerFactory creation</h2>
<p>The <strong>FtpServerFactory</strong> is associated with a <strong>FtpServerContext</strong> instance, which defines a set of elements:</p>
<ul>
<li>a <strong>CommandFactory</strong> instance</li>
<li>a <strong>ConnectionConfig</strong> instance</li>
<li>a <strong>FileSystemFactory</strong> instance</li>
<li>a <strong>FtpletContainer</strong> instance</li>
<li>a <strong>FtpStatistics</strong> instance</li>
<li>a set of <strong>Listener</strong> instances</li>
<li>a <strong>MessageResource</strong> instance. It manages the messages  (code and sub-ids) associated with the various supported languages.</li>
<li>a <strong>UserManager</strong> instance</li>
</ul>
<p>The class hierarchy is the following:</p>
<pre><code class="language-goat" data-lang="goat">
 .-------------.
| FtpletContext |
 '-------------'
        ^
        |   .----------------.
        '--| FtpServerContext |
            '----------------'
                     ^
                     |   .-----------------------.
                     '--| DefaultFtpServerContext |
                         '-----------------------'

</code></pre><h3 id="messageresourcefactory-and-messageresource">MessageResourceFactory and MessageResource</h3>
<p>The <strong>MessageResourceFactory</strong> is used to create the <strong>MessageResource</strong> instance which will be an instance of the <strong>DefaultMessageResource</strong> class).</p>
<p>The <strong>MessageResource</strong> instance contains the messages for all the supported languages. Those messages are those sent to the client when a command is executed. For instance, the response for a <strong>STOR</strong> command may be:</p>
<pre><code>Can't open data connection.
</code></pre><p>This is defined in the <em>FtpStatus.properties</em> file, among other response messages:</p>
<pre><code>...
425.STOR=Can't open data connection.
...
</code></pre><p>Those messages are read from various places (the &lt;lang&gt; tag is the name of the language to use, like <strong>en</strong>, <strong>fr</strong>, etc):</p>
<ul>
<li>Default messages
<ul>
<li><em>org/apache/ftpserver/message/FtpStatus.properties</em></li>
<li><em>org/apache/ftpserver/message/FtpStatus</em>&lt;lang&gt;.properties_</li>
</ul>
</li>
<li>Custom messages
<ul>
<li><em>org/apache/ftpserver/message/FtpStatus.gen</em></li>
<li><em>org/apache/ftpserver/message/FtpStatus</em>&lt;lang&gt;.gen_</li>
</ul>
</li>
</ul>
<h2 id="commandfactory">CommandFactory</h2>
<p>This factory creates a <strong>Map</strong> which contains the <em>Command</em> instances associated with the command name. The current version support those commands:</p>
<table>
<thead>
<tr>
<th>Command</th>
<th>RFC reference</th>
</tr>
</thead>
<tbody>
<tr>
<td>ABOR</td>
<td>rfc959, 4.1.3</td>
</tr>
<tr>
<td>ACCT</td>
<td>rfc959, 4.1.1</td>
</tr>
<tr>
<td>APPE</td>
<td>rfc959, 4.1.3</td>
</tr>
<tr>
<td>AUTH</td>
<td>rfc2228, 3</td>
</tr>
<tr>
<td>CDUP</td>
<td>rfc959, 4.1.1</td>
</tr>
<tr>
<td>CWD</td>
<td>rfc959, 4.1.1</td>
</tr>
<tr>
<td>DELE</td>
<td>rfc959, 4.1.3</td>
</tr>
<tr>
<td>EPRT</td>
<td>rfc2428, 2</td>
</tr>
<tr>
<td>EPSV</td>
<td>rfc2428, 3</td>
</tr>
<tr>
<td>FEAT</td>
<td>rfc2389, 3</td>
</tr>
<tr>
<td>HELP</td>
<td>rfc959, 4.1.3</td>
</tr>
<tr>
<td>LANG</td>
<td>rfc2640, 4.1</td>
</tr>
<tr>
<td>LIST</td>
<td>rfc959, 4.1.3</td>
</tr>
<tr>
<td>MD5</td>
<td>draft-twine-ftpmd5-00.txt , 3.1</td>
</tr>
<tr>
<td>MMD5</td>
<td>draft-twine-ftpmd5-00.txt , 3.2</td>
</tr>
<tr>
<td>MDTM</td>
<td>rfc3659, 3</td>
</tr>
<tr>
<td>MFMT</td>
<td>draft-somers-ftp-mfxx, 3</td>
</tr>
<tr>
<td>MKD</td>
<td>rfc959, 4.1.3</td>
</tr>
<tr>
<td>MLSD</td>
<td>rfc3659, 7</td>
</tr>
<tr>
<td>MLST</td>
<td>rfc3659, 7</td>
</tr>
<tr>
<td>MODE</td>
<td>rfc959, 4.1.2</td>
</tr>
<tr>
<td>NLST</td>
<td>rfc959, 4.1.3</td>
</tr>
<tr>
<td>NOOP</td>
<td>rfc959, 4.1.3</td>
</tr>
<tr>
<td>OPTS</td>
<td>rfc2389, 4</td>
</tr>
<tr>
<td>PASS</td>
<td>rfc959, 4.1.1</td>
</tr>
<tr>
<td>PASV</td>
<td>rfc959, 4.1.2</td>
</tr>
<tr>
<td>PBSZ</td>
<td>rfc2228, 3</td>
</tr>
<tr>
<td>PORT</td>
<td>rfc959, 4.1.2</td>
</tr>
<tr>
<td>PROT</td>
<td>rfc2228, 3</td>
</tr>
<tr>
<td>PWD</td>
<td>rfc959, 4.1.3</td>
</tr>
<tr>
<td>QUIT</td>
<td>rfc959, 4.1.1</td>
</tr>
<tr>
<td>REIN</td>
<td>rfc959, 4.1.1</td>
</tr>
<tr>
<td>REST</td>
<td>rfc959, 4.1.3, rfc3659, 5</td>
</tr>
<tr>
<td>RETR</td>
<td>rfc959, 4.1.3</td>
</tr>
<tr>
<td>RMD</td>
<td>rfc959, 4.1.3</td>
</tr>
<tr>
<td>RNFR</td>
<td>rfc959, 4.1.3</td>
</tr>
<tr>
<td>RNTO</td>
<td>rfc959, 4.1.3</td>
</tr>
<tr>
<td>SITE</td>
<td>rfc959, 4.1.3</td>
</tr>
<tr>
<td>SITE_DESCUSER</td>
<td>rfc959, 4.1.3</td>
</tr>
<tr>
<td>SITE_HELP</td>
<td>rfc959, 4.1.3</td>
</tr>
<tr>
<td>SITE_STAT</td>
<td>rfc959, 4.1.3</td>
</tr>
<tr>
<td>SITE_WHO</td>
<td>rfc959, 4.1.3</td>
</tr>
<tr>
<td>SITE_ZONE</td>
<td>rfc959, 4.1.3</td>
</tr>
<tr>
<td>SIZE</td>
<td>rfc3659, 4</td>
</tr>
<tr>
<td>STAT</td>
<td>rfc959, 4.1.3</td>
</tr>
<tr>
<td>STOR</td>
<td>rfc959, 4.1.3</td>
</tr>
<tr>
<td>STOU</td>
<td>rfc959, 4.1.3</td>
</tr>
<tr>
<td>STRU</td>
<td>rfc959, 4.1.2</td>
</tr>
<tr>
<td>SYST</td>
<td>rfc959, 4.1.3</td>
</tr>
<tr>
<td>TYPE</td>
<td>rfc959, 4.1.2</td>
</tr>
<tr>
<td>USER</td>
<td>rfc959, 4.1.1</td>
</tr>
</tbody>
</table>
<p>The class hierarchy is the following:</p>
<pre><code class="language-goat" data-lang="goat">
 .--------------.
| CommandFactory |
 '--------------'
        ^
        |   .----------------------.
        '--| DefaultCommandFactory  |
            '----------------------'

</code></pre><p>And instance of a <em>CommandFactory</em> can be obtained by calling the <em>CommandFactoryFactory.createCommandFactory</em>:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">        CommandFactoryFactory commandFactoryFactory <span style="color:#666">=</span> <span style="color:#a2f;font-weight:bold">new</span> CommandFactoryFactory<span style="color:#666">(</span><span style="color:#666">)</span><span style="color:#666">;</span>

		CommandFactory commandFactory <span style="color:#666">=</span> commandFactoryFactory<span style="color:#666">.</span><span style="color:#b44">createCommandFactory</span><span style="color:#666">(</span><span style="color:#666">)</span><span style="color:#666">;</span>    
</code></pre></div><p>The <em>CommandFactory</em> instance will contain all the previously listed commands.</p>
<p>You can add some commands in the default list:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">        CommandFactoryFactory commandFactoryFactory <span style="color:#666">=</span> <span style="color:#a2f;font-weight:bold">new</span> CommandFactoryFactory<span style="color:#666">(</span><span style="color:#666">)</span><span style="color:#666">;</span>

        commandFactoryFactory<span style="color:#666">.</span><span style="color:#b44">addCommand</span><span style="color:#666">(</span><span style="color:#b44">&#34;PASV&#34;</span><span style="color:#666">,</span> <span style="color:#a2f;font-weight:bold">new</span> PASVTest<span style="color:#666">(</span><span style="color:#666">)</span><span style="color:#666">)</span><span style="color:#666">;</span>

		CommandFactory commandFactory <span style="color:#666">=</span> commandFactoryFactory<span style="color:#666">.</span><span style="color:#b44">createCommandFactory</span><span style="color:#666">(</span><span style="color:#666">)</span><span style="color:#666">;</span>    
</code></pre></div><p>The <em>CommandFactory</em> instance will contain all the previously listed commands plus the added <strong>PASV</strong> command.</p>
<p>You can also create non standard commands by setting the <em>CommandFactoryFactory.useDefaultCommands</em> to false. here is an example:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">        CommandFactoryFactory commandFactoryFactory <span style="color:#666">=</span> <span style="color:#a2f;font-weight:bold">new</span> CommandFactoryFactory<span style="color:#666">(</span><span style="color:#666">)</span><span style="color:#666">;</span>

        <span style="color:#080;font-style:italic">// Add a non standard command
</span><span style="color:#080;font-style:italic"></span>        commandFactoryFactory<span style="color:#666">.</span><span style="color:#b44">addCommand</span><span style="color:#666">(</span><span style="color:#b44">&#34;foo&#34;</span><span style="color:#666">,</span> <span style="color:#a2f;font-weight:bold">new</span> NOOP<span style="color:#666">(</span><span style="color:#666">)</span><span style="color:#666">)</span><span style="color:#666">;</span>

        <span style="color:#080;font-style:italic">// tell the factory it will contain non-standard commands
</span><span style="color:#080;font-style:italic"></span>        commandFactoryFactory<span style="color:#666">.</span><span style="color:#b44">setUseDefaultCommands</span><span style="color:#666">(</span><span style="color:#a2f;font-weight:bold">false</span><span style="color:#666">)</span><span style="color:#666">;</span>

        <span style="color:#080;font-style:italic">// Get the commandfactory having only the created non standard command
</span><span style="color:#080;font-style:italic"></span>		CommandFactory commandFactory <span style="color:#666">=</span> commandFactoryFactory<span style="color:#666">.</span><span style="color:#b44">createCommandFactory</span><span style="color:#666">(</span><span style="color:#666">)</span><span style="color:#666">;</span>


</code></pre></div><p>Here, the <em>Commandfactory</em> instance will onkly contain non-standard commands, and none of the default commands.</p>
<h2 id="usermanagerfactory">UserManagerFactory</h2>
<p>This factory creates an <em>UserManager</em> instance, which may be file based or Database based.</p>
<p>There are two implementations of this factory:</p>
<ul>
<li><em>DbUserManagerFactory</em> which takes the information relative to the user from a <strong>SQL</strong> Database</li>
<li><em>PropertiesUserManagerFactory</em> which takes the information relative to the user from properties file</li>
</ul>
<p>The <em>User</em> class contain information about the users:</p>
<ul>
<li><em>ftpserver.user.{username}.homedirectory</em>: Path to the home directory for the user, based on the file system implementation used</li>
<li><em>ftpserver.user.{username}.userpassword</em>: The password for the user. Can be in clear text, MD5 hash or salted SHA hash based on the configuration on the user manager</li>
<li><em>ftpserver.user.{username}.enableflag</em>: true if the user is enabled, false otherwise</li>
<li><em>ftpserver.user.{username}.writepermission</em>: true if the user is allowed to upload files and create directories, false otherwise</li>
<li><em>ftpserver.user.{username}.idletime</em>: The number of seconds the user is allowed to be idle before disconnected. 0 disables the idle timeout</li>
<li><em>ftpserver.user.{username}.maxloginnumber</em>: The maximum number of concurrent logins by the user. 0 disables the check.</li>
<li><em>ftpserver.user.{username}.maxloginperip</em>: The maximum number of concurrent logins from the same IP address by the user. 0 disables the check.</li>
<li><em>ftpserver.user.{username}.uploadrate</em>: The maximum number of bytes per second the user is allowed to upload files. 0 disables the check.</li>
<li><em>ftpserver.user.{username}.downloadrate</em>: The maximum number of bytes per second the user is allowed to download files. 0 disables the check.</li>
</ul>
<p>Here is an exemple of file containing some users:</p>
<pre><code>ftpserver.user.admin.homedirectory=./test-tmp/ftproot
ftpserver.user.admin.userpassword=admin
ftpserver.user.admin.enableflag=true
ftpserver.user.admin.writepermission=true
ftpserver.user.admin.idletime=0
ftpserver.user.admin.maxloginnumber=0
ftpserver.user.admin.maxloginperip=0
ftpserver.user.admin.uploadrate=0
ftpserver.user.admin.downloadrate=0

</code></pre><p>In any case, we use a <em>UserManager</em> instance to manage the users once read by one of the two previous factories.</p>
<h3 id="usermanager">UserManager</h3>
<p>The hierarchy is the following:</p>
<pre><code class="language-goat" data-lang="goat">
  .-----------.
 | UserManager |
  '-----------'
        ^
        |   .-------------------.
        '--| AbstractUserManager |
            '-------------------'
                       ^
                       |   .-------------.
                       +--| DbUserManager |
                       |   '-------------'
                       |
                       |   .---------------------.
                       '--| PropertiesUserManager |
                           '---------------------'
</code></pre><p>Those classes are used to get the <strong>User</strong> information. The <strong>User</strong> class stores the following data:</p>
<ul>
<li><em>authorities</em>: The user&rsquo;s permissions. One of <em>WritePermission</em>, <em>TransferRatePermission</em> and <em>ConcurrentLoginPermission</em></li>
<li><em>homeDir</em>: The user&rsquo;s home directory</li>
<li><em>isEnabled</em>: A flag set to <em>true</em> if teh user is enabled</li>
<li><em>maxIdleTimeSec</em>: The maximum time the user can remain iddle (default to infinite)</li>
<li><em>name</em>: The user&rsquo;s name</li>
<li><em>password</em>: The hashed user&rsquo;s password</li>
</ul>
<p>The <em>User</em> interface is used to expose the available methods. The class hierarchy is:</p>
<pre><code class="language-goat" data-lang="goat">
  .----.
 | User |
  '----'
     ^
     |   .--------.
     '--| BaseUser |
         '--------'
</code></pre><p>As the users are stored either in a property file or in a SQL Database, we need a way to manage those users. There is a class that can bbe used to add users in those containes: the <em>AddUser</em> class. Otherwise, the <em>UserManager</em> instance can be used to delete or get users from their container. Creating a user programatically can be done either with the <em>UserFactory</em> or by instanciating a <em>BaseUser</em> class.</p>
<h3 id="filesystemfactory">FileSystemFactory</h3>
<p>This factory will be used to create the directory the user will access. The factory will be used later.</p>
<h3 id="ftpletcontainer">FtpletContainer</h3>
<p>The <em>FtpletCinainer</em> is holding all the <em>Ftplet</em> elements in a <em>HashMap</em>.</p>
<p>A <em>Ftplet</em> is a piece of code that get executed before or after a command, and before and after a connection.</p>
<p>Here is the class hierarchy:</p>
<pre><code class="language-goat" data-lang="goat">
  .------.
 | Ftplet |
  '------'
      ^
      |   .---------------.
      '--| FtpletContainer |
          '---------------'
                       ^
                       |   .----------------------.
                       '--| DefaultFtpletContainer |
                           '----------------------'
</code></pre><h3 id="ftpstatistics">FtpStatistics</h3>
<p>This is used to store statistics about the FtpServer usage. The class hierarchy is teh following:</p>
<pre><code class="language-goat" data-lang="goat">
  .-------------.
 | FtpStatistics |
  '-------------'
         ^
         |   .-------------------.
         '--| ServerFtpStatistics |
             '-------------------'
                       ^
                       |   .--------------------.
                       '--| DefaultFtpStatistics |
                           '--------------------'
</code></pre><p>The <em>FtpStatistics</em> contains all the getters, the <em>ServerFtpStatistics</em> contains all the setters.</p>
<p>The following values are followed:</p>
<ul>
<li><em>startTime</em></li>
<li><em>uploadCount</em></li>
<li><em>downloadCount</em></li>
<li><em>deleteCount</em></li>
<li><em>mkdirCount</em></li>
<li><em>rmdirCount</em></li>
<li><em>currLogins</em></li>
<li><em>totalLogins</em></li>
<li><em>totalFailedLogins</em></li>
<li><em>currAnonLogins</em></li>
<li><em>totalAnonLogins</em></li>
<li><em>currConnections</em></li>
<li><em>totalConnections</em></li>
<li><em>bytesUpload</em></li>
<li><em>bytesDownload</em></li>
</ul>
<p>The methods are called by the <em>Command</em> instances.</p>
<h3 id="connectionconfigfactory">ConnectionConfigFactory</h3>
<p>This class create a <em>ConnectionConfig</em> instance.</p>
<p>It manages the following server parameters:</p>
<ul>
<li><em>maxLogins</em></li>
<li><em>anonymousLoginEnabled</em></li>
<li><em>maxAnonymousLogins</em></li>
<li><em>maxLoginFailures</em></li>
<li><em>loginFailureDelay</em></li>
<li><em>maxThreads</em></li>
</ul>
<p>By default, the server configuration will allow 3 fails login attempts, insert a 500ms delay between each attempt, allow 10 concurrent users, allow 10 anonymous users, and do not limit the number of threads dedicated for command processing.</p>
<h3 id="listeners">Listeners</h3>
<p>The <em>Listeners</em> are used to manage communications with the users. We keep a <em>Map</em> of created listeners. Those listeners are created by a <em>ListenerFactory</em>.</p>
<p>The <em>ListenerFactory</em> class contains a <em>DataConnectionConfiguration</em> instance which is created by a <em>DataConnectionConfigurationFactory</em> factory class.</p>
<p>The class hierarchy is the following:</p>
<pre><code class="language-goat" data-lang="goat">
  .--------.
 | Listener |
  '--------'
      ^
      |   .----------------.
      '--| AbstractListener |
          '----------------'
                  ^
                  |   .-----------.
                  '--| NioListener |
                      '-----------'
</code></pre><p>The <em>NioListener</em> class is responsible for all the TCP communication with the user. It depends on <strong>MINA</strong> <em>SocketAcceptor</em>_ class.</p>
<p>The <em>AbstractListener</em> class</p>
<p>The <em>SocketAcceptor</em> instance is declared with the following parameters:</p>
<ul>
<li><em>ReuseAddress</em> is set to true</li>
<li>The read buffer size is set to 2048</li>
<li>The receive buffer size is set to 512</li>
<li>The idle time is set to 300 seconds</li>
<li>The service chain contains, in this order from server to handler:
<ul>
<li>An optional <em>SslFilter</em></li>
<li>A <em>MdcInjectionFilter</em></li>
<li>An optional <em>MinaSessionFilter</em></li>
<li>A <em>ExecutorFilter</em></li>
<li>A <em>ProtocolCodecFilter</em>: The decoder is a simple instance of a <em>TextLineDecoder</em>. The encoder is an instance of a <em>FtpResponseEncoder</em>.</li>
<li>A <em>MdcInjectionFilter</em></li>
<li>A <em>FtpLoggingFilter</em></li>
</ul>
</li>
</ul>
<p>A <em>Listener</em> instance can be created through a call to the <em>ListenerFactory.createListener()</em> method, it should not be created directly. This method instanciate a <em>NioListener</em> after having chekced that the provided server name is valid.</p>
<p>Internally, it creates a <em>FtpHandler</em> instances, which is used to handle all the incoming <em>FTP</em> requests.</p>
<p>The instanciated <em>listener</em> will be added to the map of listeners, as <em>default</em>.</p>
<p>The server factory has been created, we now have to create the server and to start it.</p>


            
    <div class="nav">
        <div class="nav_prev">
            
                
                <a href="../ch5-developping/ch5-developping.html">Chapter 5 - Developping</a>
            
        </div>
        <div class="nav_up">
            
                
                <a href="../documentation-toc.html">Documentation</a>
            
        </div>
        <div class="nav_next">
            
                &nbsp;
            
        </div>
        <div class="clearfix"></div>
    </div>


        </div>
        <div id="endContent"></div>
    </div>

    <div id="footer">
    &copy; 2003-2024, <a href="https://www.apache.org">The Apache Software Foundation</a> - <a href="https://privacy.apache.org/policies/privacy-policy-public.html">Privacy Policy</a><br />
    Apache MINA, MINA, Apache Vysper, Vysper, Apache SSHd, SSHd, Apache FtpServer, FtpServer, Apache AsyncWeb, AsyncWeb,
    Apache, the Apache feather logo, and the Apache Mina project logos are trademarks of The Apache Software Foundation.
</div>

</div>


</body>

</html>
